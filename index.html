<!DOCTYPE html>
<html>
<head>
    <title>Mono</title>

    <link rel="stylesheet" href="public/style.css">
    <!--<link rel="stylesheet" href="public/style.css">-->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="./public/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.js"></script>

</head>
<body>
<div>
    <div class='App'>
        <div class='buttons-container'>
            <div style="width: 200px;margin: auto">
                <button id="showTable" class="btn btn-success">Open Calendar</button>
            </div>
        </div>

        <div id='table-content'>

        </div>
    </div>
</div>

</body>
</html>


<script>

    function appendHtml(el, str) {
        var div = document.createElement('div');
        div.innerHTML = str;
        while (div.children.length > 0) {
            el.appendChild(div.children[0]);
        }
    }
    var dateNow = new Date();
    var button = document.getElementById("showTable");
    button.addEventListener("click",function(el){
        if( document.getElementById('table')){
        document.getElementById('table').parentNode.removeChild( document.getElementById('table') );}

            var heades = [];
            var dayInfo = [];
            var data = [];


            var xmlhttp = new XMLHttpRequest();

            xmlhttp.onreadystatechange = function () {

                if (this.readyState == 4 && this.status == 200) {

                    data = JSON.parse(this.response);

                    for (var i = 0; i < 7; i++) {

                        heades.push(
                            '<td>' +
                            '<div class="table-header">' + moment().add(i, 'days').format('dddd') + '</div>' +
                            '</td>')
                    }


                    data.forEach(function (item) {


                        var description = item.status.active ? '<a>' + item.status.description + '</a>' : '<p>' + item.status.description + '</p>';
                        var active = item.status.active ? 'active-day' : '';

                        dayInfo.push(
                            '<td>' +
                                '<div class="day-info ' + active + '">' +
                                    '<p>' + item.date + '</p>' +
                                    description +
                                '</div>' +
                            '</td>')

                    });


                    var table = ('<table id="table">' +
                        '<thead>' +
                            '<tr>' +
                                 heades +
                             '</tr>' +
                        '</thead>' +
                        '<tbody>' +
                            '<tr>' +
                                dayInfo +
                            '</tr>' +
                        '</tbody>' +
                    '</table>');

                    appendHtml(document.getElementById('table-content'), table)

                }
            };

        xmlhttp.open("GET", "http://localhost:3030/public/schedule.php?date="+dateNow, true);
        xmlhttp.send();

    },false);
</script>